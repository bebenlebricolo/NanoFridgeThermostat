#include "numbers_small.h"

#include <stdint.h>
#include <stdlib.h>
#include <string.h>

#define IBASE 10
#define TEMP_ITOA_MAX_DIGIT 2U

// 'degFsmall', 8x8px
const uint8_t sm_3x8_degFsmall [] PROGMEM = {
    0x40, 0xa0, 0x40, 0x00, 0xe0, 0x80, 0xc0, 0x80
};
// 'degCsmall', 8x8px
const uint8_t sm_3x8_degCsmall [] PROGMEM = {
    0x40, 0xa0, 0x40, 0x00, 0x60, 0x80, 0x80, 0x60
};
// '-_2small', 8x1px
const uint8_t sm_3x3_minus [] PROGMEM = {
    0xe0
};
// '+_2small', 8x3px
const uint8_t sm_3x3_plus [] PROGMEM = {
    0x40, 0xe0, 0x40
};
// 'degFbig', 8x18px
const uint8_t sm_7x18_degFbig [] PROGMEM = {
    0x7c, 0xfe, 0xc6, 0xc6, 0xc6, 0xfe, 0x7c, 0x00, 0xfe, 0xfe, 0xc0, 0xc0, 0xf8, 0xf8, 0xc0, 0xc0,
    0xc0, 0xc0
};
// 'degCbig', 8x18px
const uint8_t sm_7x18_degCbig [] PROGMEM = {
    0x7c, 0xfe, 0xc6, 0xc6, 0xc6, 0xfe, 0x7c, 0x00, 0x3e, 0x7e, 0x60, 0xe0, 0xc0, 0xc0, 0xe0, 0x60,
    0x7e, 0x3e
};
// 'degF', 8x15px
const uint8_t sm_5x15_degF [] PROGMEM = {
    0x70, 0xd8, 0x88, 0xd8, 0x70, 0x00, 0xf8, 0xf8, 0xc0, 0xf0, 0xf0, 0xc0, 0xc0, 0xc0, 0xc0
};
// 'degC', 8x15px
const uint8_t sm_5x15_degC [] PROGMEM = {
    0x70, 0xd8, 0x88, 0xd8, 0x70, 0x00, 0x78, 0xf8, 0xe0, 0xc0, 0xc0, 0xc0, 0xe0, 0xf8, 0x78
};
// '-_1', 8x2px
const uint8_t sm_6x6_minus [] PROGMEM = {
    0xfc, 0xfc
};
// '+_1', 8x6px
const uint8_t sm_6x6_plus [] PROGMEM = {
    0x30, 0x30, 0xfc, 0xfc, 0x30, 0x30
};
// '9', 16x18px
const uint8_t sm_12x18_nine [] PROGMEM = {
    0x1f, 0xc0, 0x7f, 0xe0, 0x70, 0xe0, 0xe0, 0x60, 0xe0, 0x70, 0xe0, 0x70, 0xe0, 0x70, 0xf0, 0xf0,
    0xff, 0xf0, 0x7f, 0xf0, 0x1f, 0x30, 0x00, 0x30, 0x00, 0x30, 0xc0, 0x30, 0xe0, 0x70, 0xf0, 0xe0,
    0x7f, 0xe0, 0x3f, 0xc0
};
// '8', 16x18px
const uint8_t sm_12x18_eight [] PROGMEM = {
    0x3f, 0xc0, 0x7f, 0xe0, 0xf0, 0xf0, 0xe0, 0x70, 0xe0, 0x70, 0xf0, 0xf0, 0xff, 0xf0, 0x7f, 0xe0,
    0x3f, 0xc0, 0x7f, 0xe0, 0xf0, 0xf0, 0xe0, 0x70, 0xe0, 0x70, 0xe0, 0x70, 0xf0, 0xf0, 0xff, 0xf0,
    0x7f, 0xe0, 0x1f, 0x80
};
// '7', 16x18px
const uint8_t sm_12x18_seven [] PROGMEM = {
    0xff, 0xf0, 0xff, 0xf0, 0x00, 0x30, 0x00, 0x70, 0x00, 0xf0, 0x01, 0xe0, 0x03, 0xc0, 0x07, 0x80,
    0x07, 0x00, 0x0f, 0x00, 0x0e, 0x00, 0x1e, 0x00, 0x1c, 0x00, 0x3c, 0x00, 0x38, 0x00, 0x78, 0x00,
    0x70, 0x00, 0x70, 0x00
};
// '6', 16x18px
const uint8_t sm_12x18_six [] PROGMEM = {
    0x07, 0x80, 0x0f, 0x80, 0x1f, 0x00, 0x3c, 0x00, 0x38, 0x00, 0x78, 0x00, 0x7f, 0x00, 0xff, 0xc0,
    0xff, 0xe0, 0xf0, 0xe0, 0xe0, 0x70, 0xe0, 0x70, 0xe0, 0x70, 0xe0, 0x70, 0xf0, 0xf0, 0x7f, 0xe0,
    0x3f, 0xc0, 0x1f, 0x80
};
// '5', 16x18px
const uint8_t sm_12x18_five [] PROGMEM = {
    0xff, 0xf0, 0xff, 0xf0, 0xf0, 0x00, 0xf0, 0x00, 0xf0, 0x00, 0xff, 0x00, 0xff, 0xc0, 0xff, 0xe0,
    0x01, 0xe0, 0x00, 0xf0, 0x00, 0x70, 0x00, 0x70, 0x00, 0x70, 0x00, 0xf0, 0xe1, 0xe0, 0xff, 0xe0,
    0x7f, 0xc0, 0x3f, 0x80
};
// '4', 16x18px
const uint8_t sm_12x18_four [] PROGMEM = {
    0x07, 0xc0, 0x0f, 0xc0, 0x0f, 0xc0, 0x1f, 0xc0, 0x1d, 0xc0, 0x3d, 0xc0, 0x39, 0xc0, 0x79, 0xc0,
    0x71, 0xc0, 0xf1, 0xc0, 0xe1, 0xc0, 0xff, 0xf0, 0xff, 0xf0, 0xff, 0xf0, 0x01, 0xc0, 0x01, 0xc0,
    0x01, 0xc0, 0x01, 0xc0
};
// '3', 16x18px
const uint8_t sm_12x18_three [] PROGMEM = {
    0x3f, 0xc0, 0x7f, 0xe0, 0xff, 0xf0, 0xf0, 0xf0, 0xe0, 0xf0, 0x00, 0xf0, 0x03, 0xe0, 0x0f, 0xe0,
    0x0f, 0xc0, 0x0f, 0xe0, 0x03, 0xe0, 0x00, 0xf0, 0x00, 0xf0, 0x00, 0xf0, 0xe1, 0xf0, 0xff, 0xf0,
    0xff, 0xe0, 0x7f, 0xc0
};
// '2', 16x18px
const uint8_t sm_12x18_two [] PROGMEM = {
    0x3f, 0xc0, 0x7f, 0xe0, 0xf0, 0xf0, 0xe0, 0x70, 0xc0, 0x70, 0x00, 0x70, 0x00, 0x70, 0x00, 0xf0,
    0x01, 0xe0, 0x03, 0xe0, 0x07, 0xc0, 0x0f, 0x80, 0x1f, 0x00, 0x3e, 0x00, 0x7c, 0x00, 0xfc, 0x00,
    0xff, 0xf0, 0xff, 0xf0
};
// '1', 16x18px
const uint8_t sm_12x18_one [] PROGMEM = {
    0x07, 0x00, 0x0f, 0x00, 0x1f, 0x00, 0x3f, 0x00, 0x7f, 0x00, 0xff, 0x00, 0xff, 0x00, 0xcf, 0x00,
    0x0f, 0x00, 0x0f, 0x00, 0x0f, 0x00, 0x0f, 0x00, 0x0f, 0x00, 0x0f, 0x00, 0x0f, 0x00, 0x0f, 0x00,
    0xff, 0xf0, 0xff, 0xf0
};

// '0', 12x18px
const uint8_t sm_12x18_zero [] PROGMEM = {
    0x1f, 0x80, 0x7f, 0xe0, 0x70, 0xe0, 0xe0, 0x70, 0xc0, 0x30, 0xc0, 0x30, 0xc0, 0x30, 0xc0, 0x30,
    0xc0, 0x30, 0xc0, 0x30, 0xc0, 0x30, 0xc0, 0x30, 0xc0, 0x30, 0xc0, 0x30, 0xe0, 0x70, 0x70, 0xe0,
    0x7f, 0xe0, 0x1f, 0x80
};



void draw_temperature(const int8_t temperature, image_buffer_t * const buffer, const bool overwrite)
{
    (void) buffer;
    (void) overwrite;

    // 2's complement MSB is the sign bit.
    bool is_positive = (bool) temperature >> 8;

    // Buffer that'll hold the single digits of the input temperature
    // -> temperature = -35
    //    numbers = {3,5} ; is_positive = false;
    uint8_t numbers[TEMP_ITOA_MAX_DIGIT] = {0};
    int8_t tmp = temperature;
    uint8_t idx = 0;
    while(tmp != 0 && idx < TEMP_ITOA_MAX_DIGIT)
    {
        numbers[idx] = temperature % IBASE;
        idx++;
        tmp /= IBASE;
    }

    if(is_positive)
    {
        // Will break, needs finer-grain implementation : buffers are not of the same sizes !
        // And characters are not the same width/height/
        memcpy(sm_6x6_plus, buffer->data, sizeof(sm_6x6_plus));
    }
    else
    {

    }




}

